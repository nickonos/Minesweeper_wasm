<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rust WASM Minesweeper</title>
    <link rel="icon" type="image/x-icon" href="./Minesweeperlogo.jpg">
    <link rel="stylesheet" href="index.css">
    <link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
</head>
<body>
    <div id="root">
        <div class="minesweeper-scoreboard">
            <div class="minesweeper-counter" id="bomb-counter">
                001
            </div>
            <button class="minesweeper-start-button">
                ðŸ™‚
            </button>

            <div class="minesweeper-counter" id="time-counter">
                001
            </div>
        </div>
        <div class="minesweeper-container" id="minesweeper-container">

        </div>
    </div>

    <script type="module">
        import init, {GetMinesweeper, ClickField} from "./pkg/Minesweeper_wasm.js";

        class MinesweeperClass{
            constructor() {
                this.initialize()
            }

            initialize = async () => {
                await init()
                this.MinesweeperArray = GetMinesweeper()

                let container = document.getElementById("minesweeper-container")

                this.MinesweeperArray.map((item, y_key) => {

                    let cellContainer = document.createElement("div")
                    cellContainer.setAttribute("id", "Cell-Container-"+ y_key)
                    cellContainer.setAttribute("class", "minesweeper-cell-container")
                    container.appendChild(cellContainer)

                    item.map((cell, x_key) => {
                        let div = document.createElement("div")
                        div.setAttribute("id", "Cell-"+ y_key + "-" + x_key)
                        div.setAttribute("class", "minesweeper-cell")
                        div.onclick = (e => this.onCellClick(e))
                        cellContainer.appendChild(div)
                    })

                })
            }

            onCellClick(e){
                let isFlag = e.ctrlKey

                let Cell = e.target

                let arr = Cell.id.split('-')

                let y = arr[1]
                let x = arr[2]
                let input = {
                    fields : this.MinesweeperArray,
                    x: x,
                    y: y
                }
                if (!isFlag){
                    ClickField(input)
                }

                console.log(y,x)
                console.log(e)
            }
        }

        let ms = new MinesweeperClass()
    </script>
</body>
</html>